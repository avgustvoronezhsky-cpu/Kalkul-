<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–î–¢–ü –í–æ—Ä–æ–Ω–µ–∂ ‚Äî –õ–æ–∫–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<style>
body { font-family: Arial, sans-serif; padding: 10px; background: #f0f5f5; }
h1, h2 { text-align: center; }
section { background: #fff; padding: 15px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);}
#map { height: 400px; width: 100%; margin-bottom: 10px; }
table { width: 100%; border-collapse: collapse; margin-top: 10px; }
th, td { border: 1px solid #ccc; padding: 8px; }
th { background: #333; color: #fff; }
tr:nth-child(even){background:#eee;}
input, button { padding: 8px; margin: 5px 0; width: 100%; box-sizing: border-box;}
</style>
</head>
<body>

<h1>–î–¢–ü –í–æ—Ä–æ–Ω–µ–∂ ‚Äî –õ–æ–∫–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</h1>

<section>
  <h2>–ö–∞—Ä—Ç–∞ –î–¢–ü</h2>
  <div id="map"></div>
</section>

<section>
  <h2>–°–≤–æ–¥–∫–∞ –ø–æ —Ä–∞–π–æ–Ω–∞–º</h2>
  <table id="districtTable">
    <thead>
      <tr><th>–†–∞–π–æ–Ω</th><th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –î–¢–ü</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

<section>
  <h2>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä–∞—Ö–æ–≤–æ–π —Å—É–º–º—ã</h2>
  <input type="text" id="policy" placeholder="–ù–æ–º–µ—Ä –ø–æ–ª–∏—Å–∞">
  <input type="number" id="damage" placeholder="–°—É–º–º–∞ —É—â–µ—Ä–±–∞">
  <button id="checkInsurance">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—ã–ø–ª–∞—Ç—É</button>
  <p id="insuranceResult"></p>
</section>

<section>
  <h2>–°—Ä–µ–¥–Ω—è—è —Å—É–º–º–∞ –≤—ã–ø–ª–∞—Ç</h2>
  <p id="avgPayment"></p>
</section>

<script>
// ===== –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram =====
const BOT_TOKEN = "7540783502:AAGaCzOo4G951ECpFBeUED5_Mhk0qFdlkFI";
const CHAT_ID = "881133631";

function sendTelegram(message){
    fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({chat_id: CHAT_ID, text: message})
    }).catch(err => console.log("Telegram error:", err));
}

// ===== –°–∏–º—É–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –î–¢–ü =====
const dpsData = [
  {name:"–ò–≤–∞–Ω–æ–≤ –ò.–ò.", time:"08:30", street:"–ú–æ—Å–∫–æ–≤—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç", district:"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", lat:51.660, lon:39.200, damage:120000},
  {name:"–ü–µ—Ç—Ä–æ–≤ –ü.–ü.", time:"18:15", street:"–õ–µ–Ω–∏–Ω—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç", district:"–õ–µ–Ω–∏–Ω—Å–∫–∏–π", lat:51.660, lon:39.210, damage:80000},
  {name:"–°–∏–¥–æ—Ä–æ–≤ –°.–°.", time:"09:10", street:"–ü—Ä–æ—Å–ø–µ–∫—Ç –ü–∞—Ç—Ä–∏–æ—Ç–æ–≤", district:"–ñ–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–π", lat:51.650, lon:39.220, damage:95000},
  {name:"–ö—É–∑–Ω–µ—Ü–æ–≤ –ö.–ö.", time:"17:45", street:"–ú–æ—Å–∫–æ–≤—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç", district:"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", lat:51.662, lon:39.205, damage:110000}
];

// ===== –ö–∞—Ä—Ç–∞ =====
const map = L.map('map').setView([51.660, 39.200], 13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

// –ú–∞—Ä–∫–µ—Ä—ã –∏ –ø–æ–¥—Å–∫–∞–∑–∫–∏
dpsData.forEach(dtp => {
  const marker = L.marker([dtp.lat, dtp.lon]).addTo(map);
  marker.bindPopup(`<b>${dtp.name}</b><br>${dtp.street}<br>–†–∞–π–æ–Ω: ${dtp.district}<br>–°—É–º–º–∞ —É—â–µ—Ä–±–∞: ${dtp.damage} —Ä—É–±.<br>–í—Ä–µ–º—è: ${dtp.time}`);
});

// ===== –°–≤–æ–¥–∫–∞ –ø–æ —Ä–∞–π–æ–Ω–∞–º =====
const districtCount = {};
dpsData.forEach(d => districtCount[d.district] = (districtCount[d.district]||0)+1);
const districtTable = document.querySelector("#districtTable tbody");
Object.entries(districtCount).sort((a,b)=>b[1]-a[1]).forEach(([district,count])=>{
  const tr = document.createElement("tr");
  tr.innerHTML = `<td>${district}</td><td>${count}</td>`;
  districtTable.appendChild(tr);
});

// ===== –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä–∞—Ö–æ–≤–æ–π —Å—É–º–º—ã =====
document.getElementById("checkInsurance").addEventListener("click", ()=>{
  const policy = document.getElementById("policy").value.trim();
  const damage = parseFloat(document.getElementById("damage").value);
  if(!policy || isNaN(damage)){ alert("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ"); return; }
  // –°–∏–º—É–ª—è—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ ‚Äî 80% –ø–æ–∫—Ä—ã—Ç–∏–µ
  const payout = Math.round(damage*0.8);
  document.getElementById("insuranceResult").innerText = `–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≤—ã–ø–ª–∞—Ç–∞ –ø–æ –ø–æ–ª–∏—Å—É ${policy}: ${payout} —Ä—É–±.`;
});

// ===== –°—Ä–µ–¥–Ω—è—è —Å—É–º–º–∞ –≤—ã–ø–ª–∞—Ç =====
const avg = Math.round(dpsData.reduce((a,b)=>a+b.damage,0)/dpsData.length);
document.getElementById("avgPayment").innerText = `–°—Ä–µ–¥–Ω—è—è —Å—É–º–º–∞ –≤—ã–ø–ª–∞—Ç—ã –ø–æ –±–∞–∑–µ: ${avg} —Ä—É–±.`;

// ===== Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ =====
let message = "üì¢ –ù–æ–≤—ã–µ –î–¢–ü –í–æ—Ä–æ–Ω–µ–∂:\n";
dpsData.forEach(d=>message+=`${d.time} ‚Äî ${d.name}, ${d.street}, ${d.district}, —É—â–µ—Ä–±: ${d.damage} —Ä—É–±.\n`);
sendTelegram(message);
</script>

</body>
</html>
