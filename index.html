<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ü–æ–º–æ—â–Ω–∏–∫ –ì–ò–ë–î–î ‚Äî 9 –Ø–Ω–≤–∞—Ä—è 223</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<style>
body { font-family: Arial, sans-serif; padding: 10px; background: #f0f5f5; }
h1, h2 { text-align: center; }
section { background: #fff; padding: 15px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);}
#map { height: 500px; width: 100%; margin-bottom: 10px; }
table { width: 100%; border-collapse: collapse; margin-top: 10px; }
th, td { border: 1px solid #ccc; padding: 8px; }
th { background: #333; color: #fff; }
tr:nth-child(even){background:#eee;}
button {padding:5px 10px; margin-top:5px; cursor:pointer;}
</style>
</head>
<body>

<h1>–ü–æ–º–æ—â–Ω–∏–∫ –ì–ò–ë–î–î ‚Äî 9 –Ø–Ω–≤–∞—Ä—è 223</h1>

<section>
  <h2>–ö–∞—Ä—Ç–∞ —Ä–∞–π–æ–Ω–∞</h2>
  <div id="map"></div>
</section>

<section>
  <h2>–°–ø–∏—Å–æ–∫ –î–¢–ü</h2>
  <table id="dptTable">
    <thead>
      <tr><th>–£–ª–∏—Ü–∞ / –ü–µ—Ä–µ—É–ª–æ–∫</th><th>–û–ø–∏—Å–∞–Ω–∏–µ</th><th>–î–µ–π—Å—Ç–≤–∏—è</th></tr>
    </thead>
    <tbody></tbody>
  </table>
  <h3>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –î–¢–ü</h3>
  <input type="text" id="street" placeholder="–£–ª–∏—Ü–∞ / –ü–µ—Ä–µ—É–ª–æ–∫">
  <input type="text" id="desc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ">
  <button onclick="addDTP()">–î–æ–±–∞–≤–∏—Ç—å –î–¢–ü</button>
</section>

<script>
// ===== Telegram =====
const BOT_TOKEN = "7540783502:AAGaCzOo4G951ECpFBeUED5_Mhk0qFdlkFI";
const CHAT_ID = "881133631";
function sendTelegram(message){
    fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({chat_id:CHAT_ID,text:message})
    }).catch(err=>console.log("Telegram error:",err));
}

// ===== –õ–æ–∫–∞–ª—å–Ω–∞—è –±–∞–∑–∞ –î–¢–ü =====
let dptList = JSON.parse(localStorage.getItem("dptList")||"[]");

// ===== –ö–∞—Ä—Ç–∞ =====
const map = L.map('map').setView([51.6605,39.2030],15);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  attribution:'&copy; OpenStreetMap contributors'
}).addTo(map);

function addMarker(dtp){
  const marker = L.circleMarker([51.6605 + (Math.random()-0.5)*0.03, 39.2030 + (Math.random()-0.5)*0.03],{
    radius:8,
    color:'red'
  }).addTo(map);
  marker.bindPopup(`<b>${dtp.street}</b><br>${dtp.desc}`);
}

// ===== –¢–∞–±–ª–∏—Ü–∞ =====
function renderTable(){
  const tbody = document.querySelector("#dptTable tbody");
  tbody.innerHTML = "";
  dptList.forEach((dtp,index)=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${dtp.street}</td><td>${dtp.desc}</td><td><button onclick="removeDTP(${index})">–£–¥–∞–ª–∏—Ç—å</button></td>`;
    tbody.appendChild(tr);
  });
}

// ===== –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –î–¢–ü =====
function addDTP(){
  const street = document.getElementById("street").value.trim();
  const desc = document.getElementById("desc").value.trim();
  if(!street||!desc)return alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è");
  const dtp = {street,desc};
  dptList.push(dtp);
  localStorage.setItem("dptList",JSON.stringify(dptList));
  addMarker(dtp);
  renderTable();
  sendTelegram(`üö® –ù–æ–≤–æ–µ –î–¢–ü: ${street} ‚Äî ${desc}`);
  document.getElementById("street").value="";
  document.getElementById("desc").value="";
}

// ===== –£–¥–∞–ª–µ–Ω–∏–µ –î–¢–ü =====
function removeDTP(index){
  dptList.splice(index,1);
  localStorage.setItem("dptList",JSON.stringify(dptList));
  renderTable();
  location.reload(); // –æ–±–Ω–æ–≤–ª—è–µ–º –∫–∞—Ä—Ç—É
}

// ===== –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è =====
dptList.forEach(dtp=>addMarker(dtp));
renderTable();
</script>

</body>
</html>
