<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–î–¢–ü –í–æ—Ä–æ–Ω–µ–∂ ‚Äî 9 –Ø–Ω–≤–∞—Ä—è 223</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family: Arial, sans-serif; padding: 10px; background: #f0f5f5; }
h1, h2 { text-align: center; }
section { background: #fff; padding: 15px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);}
#map { height: 450px; width: 100%; margin-bottom: 10px; }
table { width: 100%; border-collapse: collapse; margin-top: 10px; }
th, td { border: 1px solid #ccc; padding: 8px; }
th { background: #333; color: #fff; }
tr:nth-child(even){background:#eee;}
</style>
</head>
<body>

<h1>–î–¢–ü –í–æ—Ä–æ–Ω–µ–∂ ‚Äî 9 –Ø–Ω–≤–∞—Ä—è 223 –∏ –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–∏</h1>

<section>
  <h2>–ö–∞—Ä—Ç–∞ –î–¢–ü</h2>
  <div id="map"></div>
</section>

<section>
  <h2>–¢–∞–±–ª–∏—Ü–∞ —É–ª–∏—Ü –∏ –ø–µ—Ä–µ—É–ª–∫–æ–≤</h2>
  <table id="streetTable">
    <thead>
      <tr><th>–£–ª–∏—Ü–∞ / –ü–µ—Ä–µ—É–ª–æ–∫</th><th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –î–¢–ü</th><th>–í—Ä–µ–º—è –¥–æ–µ–∑–¥–∞ (–º–∏–Ω)</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

<section>
  <h2>–ì—Ä–∞—Ñ–∏–∫ –î–¢–ü –ø–æ —á–∞—Å–∞–º</h2>
  <canvas id="hoursChart"></canvas>
</section>

<script>
// ===== Telegram =====
const BOT_TOKEN = "7540783502:AAGaCzOo4G951ECpFBeUED5_Mhk0qFdlkFI";
const CHAT_ID = "881133631";
function sendTelegram(message){
    fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({chat_id: CHAT_ID, text: message})
    }).catch(err => console.log("Telegram error:", err));
}

// ===== –°–∏–º—É–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –î–¢–ü =====
// –í—Å–µ —É–ª–∏—Ü—ã –≤ —Ä–∞–¥–∏—É—Å–µ 5‚Äì7 –º–∏–Ω—É—Ç –æ—Ç 9 –Ø–Ω–≤–∞—Ä—è 223
const dpsData = [
  {street:"9 –Ø–Ω–≤–∞—Ä—è", time:"08:30", lat:51.6605, lon:39.2030, damage:120000},
  {street:"–°–≤–æ–±–æ–¥—ã", time:"09:10", lat:51.6610, lon:39.2050, damage:95000},
  {street:"–†–µ–≤–æ–ª—é—Ü–∏–∏ 1905 –≥–æ–¥–∞", time:"08:45", lat:51.6590, lon:39.2000, damage:110000},
  {street:"–§—Ä–∏–¥—Ä–∏—Ö–∞ –≠–Ω–≥–µ–ª—å—Å–∞", time:"17:20", lat:51.6615, lon:39.2070, damage:70000},
  {street:"–ù–∏–∫–∏—Ç–∏–Ω—Å–∫–∞—è", time:"18:10", lat:51.6595, lon:39.2080, damage:85000},
  {street:"–î–æ–Ω–±–∞—Å—Å–∫–∞—è", time:"12:30", lat:51.6620, lon:39.2040, damage:90000},
  {street:"–ö–∞—Ä–ª–∞ –ú–∞—Ä–∫—Å–∞", time:"14:20", lat:51.6600, lon:39.2060, damage:60000},
  {street:"–ú–∏—Ä–∞", time:"08:50", lat:51.6610, lon:39.2090, damage:75000},
  {street:"–õ–µ–Ω–∏–Ω–∞", time:"16:10", lat:51.6620, lon:39.2010, damage:95000},
  {street:"–ö–æ–ª—å—Ü–æ–≤—Å–∫–∞—è", time:"17:50", lat:51.6605, lon:39.2025, damage:70000},
  {street:"–ü–ª–µ—Ö–∞–Ω–æ–≤—Å–∫–∞—è", time:"09:40", lat:51.6615, lon:39.2035, damage:88000},
  {street:"–ë–∞–∫—É–Ω–∏–Ω–∞", time:"11:15", lat:51.6595, lon:39.2045, damage:99000},
  {street:"–ö–æ–º–∏—Å—Å–∞—Ä–∂–µ–≤—Å–∫–∞—è", time:"13:30", lat:51.6625, lon:39.2055, damage:77000},
  {street:"–ö—É–∫–æ–ª–∫–∏–Ω–∞", time:"10:50", lat:51.6600, lon:39.2075, damage:67000},
  {street:"–ö—É—Ü—ã–≥–∏–Ω–∞", time:"15:05", lat:51.6610, lon:39.2085, damage:85000},
  {street:"–ö—Ä–∞—Å–Ω–æ–∞—Ä–º–µ–π—Å–∫–∞—è", time:"14:40", lat:51.6620, lon:39.2095, damage:80000},
  {street:"–í–æ—Ä–æ—à–∏–ª–æ–≤–∞", time:"12:10", lat:51.6605, lon:39.2065, damage:72000},
  {street:"–õ–µ—Å–Ω–∞—è", time:"18:30", lat:51.6615, lon:39.2070, damage:90000},
  {street:"–¢—Ä–∞–º–≤–∞–π–Ω–∞—è", time:"09:20", lat:51.6590, lon:39.2050, damage:85000},
  {street:"–û—Å—Ç—Ä–æ–≥–æ–∂—Å–∫–∞—è", time:"08:55", lat:51.6600, lon:39.2040, damage:94000},
  {street:"–†–µ–ø–∏–Ω–∞", time:"13:15", lat:51.6610, lon:39.2050, damage:66000},
  {street:"–ë–µ–≥–æ–≤–∞—è", time:"14:30", lat:51.6620, lon:39.2060, damage:71000},
  {street:"25 –Ø–Ω–≤–∞—Ä—è", time:"16:45", lat:51.6605, lon:39.2035, damage:83000},
  {street:"–°–∞–¥–æ–≤–∞—è", time:"17:30", lat:51.6615, lon:39.2045, damage:88000},
  {street:"–§—Ä–∏–¥—Ä–∏—Ö–∞ –≠–Ω–≥–µ–ª—å—Å–∞ 2", time:"08:10", lat:51.6595, lon:39.2075, damage:76000},
  {street:"50 –ª–µ—Ç –û–∫—Ç—è–±—Ä—è", time:"09:50", lat:51.6600, lon:39.2080, damage:91000},
  {street:"–ë—Ä—è–Ω—Å–∫–∞—è", time:"11:20", lat:51.6610, lon:39.2090, damage:95000},
  {street:"–ö–æ–º–º—É–Ω–∞—Ä–æ–≤", time:"15:40", lat:51.6620, lon:39.2025, damage:70000},
  {street:"–ü–ª–µ—Ö–∞–Ω–æ–≤—Å–∫–∞—è 2", time:"16:10", lat:51.6605, lon:39.2030, damage:88000},
  {street:"–ù–∏–∫–∏—Ç–∏–Ω—Å–∫–∞—è 2", time:"12:55", lat:51.6615, lon:39.2040, damage:81000}
];

// ===== –ö–∞—Ä—Ç–∞ =====
const map = L.map('map').setView([51.6605, 39.2030], 16);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–æ–≤
dpsData.forEach(dtp => {
  const color = dtp.street.startsWith("9 –Ø–Ω–≤–∞—Ä—è") ? 'red' : 'orange';
  const marker = L.circleMarker([dtp.lat, dtp.lon], {radius:8, color: color}).addTo(map);
  marker.bindPopup(`<b>${dtp.street}</b><br>–í—Ä–µ–º—è: ${dtp.time}<br>–£—â–µ—Ä–±: ${dtp.damage} —Ä—É–±.`);
});

// ===== –¢–∞–±–ª–∏—Ü–∞ —É–ª–∏—Ü =====
const streetCount = {};
dpsData.forEach(d => streetCount[d.street] = (streetCount[d.street]||0)+1);
const streetTable = document.querySelector("#streetTable tbody");
Object.entries(streetCount).sort((a,b)=>b[1]-a[1]).forEach(([street,count])=>{
  const tr = document.createElement("tr");
  const time = 5 + Math.floor(Math.random()*3); // 5‚Äì7 –º–∏–Ω—É—Ç
  tr.innerHTML = `<td>${street}</td><td>${count}</td><td>${time}</td>`;
  streetTable.appendChild(tr);
});

// ===== –ì—Ä–∞—Ñ–∏–∫ –ø–æ —á–∞—Å–∞–º =====
const hourCount = {};
dpsData.forEach(d=>{
  const hour = parseInt(d.time.split(":")[0]);
  hourCount[hour] = (hourCount[hour]||0)+1;
});
const ctx = document.getElementById("hoursChart").getContext("2d");
new Chart(ctx, {
  type:'bar',
  data:{
    labels:Object.keys(hourCount).sort((a,b)=>a-b),
    datasets:[{label:'–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –î–¢–ü', data:Object.keys(hourCount).sort((a,b)=>a-b).map(h=>hourCount[h]), backgroundColor:'#2193b0'}]
  },
  options:{responsive:true, plugins:{legend:{display:false}}}
});

// ===== Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ =====
let message = "üì¢ –î–¢–ü —Ä—è–¥–æ–º —Å 9 –Ø–Ω–≤–∞—Ä—è 223:\n";
dpsData.forEach(d=>message+=`${d.time} ‚Äî ${d.street}, —É—â–µ—Ä–±: ${d.damage} —Ä—É–±.\n`);
sendTelegram(message);
</script>

</body>
</html>
